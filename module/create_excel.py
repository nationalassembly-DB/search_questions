"""
입력받은 북마크 리스트를 통해 엑셀 파일을 만듭니다. 북마크의 단계를 기준으로 추출합니다
"""

import os
import re
from natsort import natsorted

from openpyxl import Workbook, load_workbook
from openpyxl.styles import PatternFill
from module.create_log import logging
from module.extract_bookmark import extract_bookmark


committee_dict = {
    "국방위원회": 10004,
    "국회운영위원회": 10005,
    "보건복지위원회": 10009,
    "외교통일위원회": 20017,
    "과학기술정보방송통신위원회": 20018,
    "교육위원회": 10003,
    "국토교통위원회": 20012,
    "기획재정위원회": 20013,
    "농림축산식품해양수산위원회": 20014,
    "문화체육관광위원회": 20020,
    "법제사법위원회": 10008,
    "산업통상자원중소벤처기업위원회": 20019,
    "여성가족위원회": 10749,
    "정무위원회": 10015,
    "행정안전위원회": 10950,
    "환경노동위원회": 10018
}

organization_dict = {
    "국방부": 10050,
    "국가인권위원회": 10211,
    "국회도서관": 10002,
    "국회사무처": 10001,
    "국회예산정책처": 10250,
    "국회입법조사처": 10810,
    "식품의약품안전처": 11134,
    "민주평화통일자문회의": 10126,
    "외교부": 11135,
    "통일부": 10099,
    "고등과학원": 11046,
    "과학기술연합대학원대학교": 11048,
    "과학기술인공제회": 11049,
    "과학기술일자리진흥원": 11428,
    "과학기술정보통신부": 11352,
    "광주과학기술원": 10324,
    "국가과학기술연구회": 11262,
    "국가과학기술인력개발원": 11263,
    "국가보안기술연구소": 10770,
    "국가수리과학연구소": 10893,
    "국립과천과학관": 10915,
    "국립광주과학관": 11316,
    "국립대구과학관": 11317,
    "국립부산과학관": 11337,
    "국립전파연구원": 11037,
    "국립중앙과학관": 10892,
    "기초과학연구원": 11198,
    "나노종합기술원": 11264,
    "녹색기술센터": 11147,
    "대구경북과학기술원": 11031,
    "방송문화진흥회": 10409,
    "방송통신심의위원회": 10938,
    "방송통신위원회": 10939,
    "별정우체국연금관리단": 11058,
    "세계김치연구소": 11148,
    "시청자미디어재단": 11318,
    "안전성평가연구소": 11149,
    "연구개발특구진흥재단": 11078,
    "우정사업본부": 11150,
    "우체국금융개발원": 11074,
    "우체국물류지원단": 11079,
    "우체국시설관리단": 11075,
    "울산과학기술원": 11356,
    "원자력안전위원회": 11106,
    "정보통신기획평가원": 11412,
    "정보통신산업진흥원": 10961,
    "중앙전파관리소": 11038,
    "한국건설기술연구원": 10774,
    "한국과학기술기획평가원": 10775,
    "한국과학기술단체총연합회": 11152,
    "한국과학기술연구원": 10776,
    "한국과학기술원": 10329,
    "한국과학기술정보연구원": 10777,
    "한국과학기술한림원": 11153,
    "한국과학영재학교": 11265,
    "한국과학창의재단": 10916,
    "한국교육방송공사": 10420,
    "한국기계연구원": 10331,
    "한국기초과학지원연구원": 10332,
    "한국나노기술원": 11361,
    "한국뇌연구원": 11154,
    "한국데이터산업진흥원": 11340,
    "한국방송공사": 10122,
    "한국방송광고진흥공사": 11266,
    "한국방송통신전파진흥원": 11072,
    "한국생명공학연구원": 10779,
    "한국생산기술연구원": 10780,
    "한국수력원자력": 10334,
    "한국식품연구원": 10781,
    "한국에너지기술연구원": 10335,
    "한국여성과학기술인육성재단": None,
    "한국연구재단": 10917,
    "한국우편사업진흥원": 11076,
    "한국원자력안전기술원": 10336,
    "한국원자력안전재단": 11367,
    "한국원자력연구원": 10782,
    "한국원자력의학원": 10783,
    "한국원자력통제기술원": 10337,
    "한국인터넷진흥원": 10338,
    "한국재료연구원": None,
    "한국전기연구원": 10784,
    "한국전자통신연구원": 10785,
    "한국지능정보사회진흥원": None,
    "한국지질자원연구원": 10787,
    "한국천문연구원": 10788,
    "한국철도기술연구원": 10789,
    "한국표준과학연구원": 10342,
    "한국한의학연구원": 10790,
    "한국항공우주연구원": 10791,
    "한국핵융합에너지연구원": None,
    "한국화학연구원": 10344,
    "강릉원주대학교치과병원": 11100,
    "강원대학교": 10514,
    "강원대학교병원": 10515,
    "강원도교육청": 10516,
    "경기도교육청": 10517,
    "경북대학교": 10518,
    "경북대학교병원": 10519,
    "경북대학교치과병원": 11380,
    "경상국립대학교": None,
    "경상국립대학교병원": None,
    "경상남도교육청": 10520,
    "경상북도교육청": 10549,
    "광주광역시교육청": 10550,
    "교원소청심사위원회": 10792,
    "교육부": 11130,
    "국가교육위원회": None,
    "국가평생교육진흥원": 11140,
    "국립국제교육원": 10891,
    "국립특수교육원": 10553,
    "국사편찬위원회": 10554,
    "대구광역시교육청": 10556,
    "대전광역시교육청": 10557,
    "대한민국학술원사무국": None,
    "동북아역사재단": 10712,
    "부산광역시교육청": 10559,
    "부산대학교": 10560,
    "부산대학교병원": 10561,
    "부산대학교치과병원": 11099,
    "사립학교교직원연금공단": 11101,
    "서울과학기술대학교": 11376,
    "서울교육대학교": 11103,
    "서울대학교": 10563,
    "서울대학교병원": 10564,
    "서울대학교치과병원": 10565,
    "서울특별시교육청": 10566,
    "세종특별자치시교육청": 11104,
    "울산광역시교육청": 10590,
    "인천광역시교육청": 10567,
    "인천대학교": 11306,
    "전남대학교": 10568,
    "전남대학교병원": 10569,
    "전라남도교육청": 10630,
    "전라북도교육청": 10570,
    "전북대학교": 10571,
    "전북대학교병원": 10572,
    "제주대학교": 10573,
    "제주대학교병원": 10574,
    "제주특별자치도교육청": 10575,
    "중앙교육연수원": 11220,
    "충남대학교": 10576,
    "충남대학교병원": 10577,
    "충북대학교": 10578,
    "충북대학교병원": 10579,
    "충청남도교육청": 10580,
    "충청북도교육청": 10715,
    "한국고전번역원": 10894,
    "한국교원대학교": 11221,
    "한국교육시설안전원": None,
    "한국교육학술정보원": 10584,
    "한국교직원공제회": 10582,
    "한국대학교육협의회": 10583,
    "한국방송통신대학교": 11363,
    "한국사학진흥재단": 10650,
    "한국장학재단": 10918,
    "한국전문대학교육협의회": 10587,
    "한국학중앙연구원": 10589,
    "5ㆍ18민주화운동진상규명조사위원회": None,
    "공군본부": 11341,
    "방위사업청": 10347,
    "병무청": 10069,
    "육군본부": 11342,
    "지상군구성군사령부": None,
    "지상작전사령부": None,
    "합동참모본부": 11349,
    "해군본부": 11350,
    "건설기술교육원": None,
    "경기도": 10290,
    "공간정보품질관리원": None,
    "국가철도공단": 10319,
    "국립항공박물관": None,
    "국토교통과학기술진흥원": 11161,
    "국토교통부": 11132,
    "국토안전관리원": None,
    "대한건설기계안전관리원": 11414,
    "새만금개발공사": 11409,
    "새만금개발청": 11162,
    "서울특별시": 10297,
    "인천국제공항공사": 10310,
    "제주국제자유도시개발센터": 10311,
    "주식회사에스알": 11426,
    "주택관리공단(주)": 11253,
    "주택도시보증공사": 11312,
    "코레일관광개발(주)": 11255,
    "코레일네트웍스(주)": 11256,
    "코레일로지스(주)": 11257,
    "코레일유통(주)": 11258,
    "코레일테크(주)": 11259,
    "한국공항공사": 10314,
    "한국교통안전공단": 10291,
    "한국국토정보공사": 11313,
    "한국도로공사": 10315,
    "한국도로공사서비스": None,
    "한국부동산원": None,
    "한국철도공사": 10318,
    "한국해외인프라도시개발지원공사": 11475,
    "항공안전기술원": 11328,
    "행정중심복합도시건설청": 10322,
    "국가안보실": 11143,
    "국회미래연구원": 11377,
    "대통령경호처": 11353,
    "대통령비서실": 10003,
    "관세청": 10037,
    "광주본부세관": None,
    "광주지방국세청": 11021,
    "국세청": 10036,
    "국제원산지정보원": 11314,
    "기획재정부": 10918,
    "대구본부세관": None,
    "대구지방국세청": 10951,
    "대전지방국세청": 11023,
    "부산본부세관": 10981,
    "부산지방국세청": 10952,
    "서울지방국세청": 11022,
    "인천지방국세청": None,
    "조달청": 10038,
    "중부지방국세청": 11024,
    "통계청": 10039,
    "한국수출입은행": 10043,
    "한국은행": 10040,
    "한국재정정보원": 11336,
    "한국조폐공사": 10045,
    "한국투자공사": 10513,
    "가축위생방역지원본부": 11226,
    "극지연구소": 11000,
    "농림수산식품교육문화정보원": 11164,
    "농림식품기술기획평가원": 11152,
    "농림축산식품부": 11133,
    "농업정책보험금융원": 11229,
    "농업협동조합중앙회": 10393,
    "농촌진흥청": 10079,
    "부산항만공사": 10394,
    "산림조합중앙회": 10395,
    "산림청": 10080,
    "선박해양플랜트연구소": None,
    "수산업협동조합중앙회": 10396,
    "수협은행": None,
    "여수광양항만공사": 11050,
    "울산항만공사": 10747,
    "인천항만공사": 10397,
    "축산물품질평가원": 11232,
    "축산환경관리원": None,
    "한국농수산식품유통공사": 11080,
    "한국농어촌공사": 11081,
    "한국농업기술진흥원": None,
    "한국마사회": 11082,
    "한국산림복지진흥원": 11346,
    "한국수목원정원관리원": None,
    "한국수산자원공단": 11083,
    "한국식품산업클러스터진흥원": None,
    "한국어촌어항공단": 11234,
    "한국임업진흥원": 11144,
    "한국해양과학기술원": 11145,
    "한국해양교통안전공단": 10947,
    "한국해양수산연수원": 10871,
    "한국해양진흥공사": 11386,
    "해양경찰청": 10082,
    "해양수산과학기술진흥원": 11351,
    "해양수산부": 10081,
    "해양환경공단": 11146,
    "(재)국립극단": 11389,
    "(재)국립발레단": 11390,
    "(재)국립심포니오케스트라": None,
    "(재)예술경영지원센터": 11305,
    "(재)한국공예ㆍ디자인문화진흥원": None,
    "(재)한국장애인문화예술원": None,
    "게임물관리위원회": 11212,
    "국립고궁박물관": 11107,
    "국립국악원": 10401,
    "국립국악중ㆍ고등학교": None,
    "국립국어원": 10730,
    "국립무형유산원": 11217,
    "국립문화재연구원": None,
    "국립민속박물관": 10731,
    "국립박물관문화재단": 11034,
    "국립아시아문화전당": 11303,
    "국립장애인도서관": 11417,
    "국립중앙극장": 10732,
    "국립중앙도서관": 10733,
    "국립중앙박물관": 10402,
    "국립한글박물관": 11213,
    "국립합창단": None,
    "국립해양문화재연구소": 11109,
    "국립현대미술관": 10403,
    "국외소재문화재재단": 11218,
    "국제방송교류재단": 10407,
    "궁능유적본부": None,
    "그랜드코리아레저(주)": 11071,
    "대한민국역사박물관": 11070,
    "대한장애인체육회": 10936,
    "대한체육회": 10410,
    "문화재청": 10120,
    "문화체육관광부": 10937,
    "사행산업통합감독위원회": 10940,
    "서울올림픽기념국민체육진흥공단": 10408,
    "세종학당재단": 11141,
    "스포츠윤리센터": None,
    "언론중재위원회": 10270,
    "영상물등급위원회": 10414,
    "영화진흥위원회": 10415,
    "예술원사무국": 10941,
    "예술의전당": 10416,
    "재단법인국악방송": None,
    "전통공연예술진흥재단": None,
    "태권도진흥재단": 10942,
    "한국관광공사": 10419,
    "한국도박문제예방치유원": None,
    "한국문학번역원": 11036,
    "한국문화관광연구원": 11035,
    "한국문화예술교육진흥원": 11018,
    "한국문화예술위원회": 10421,
    "한국문화예술회관연합회": 11222,
    "한국문화재재단": None,
    "한국문화정보원": 11308,
    "한국문화진흥주식회사": 11224,
    "한국언론진흥재단": 11019,
    "한국영상자료원": 10425,
    "한국예술인복지재단": 11309,
    "한국예술종합학교": 10735,
    "한국저작권보호원": None,
    "한국저작권위원회": 10949,
    "한국전통문화대학교": 11219,
    "한국정책방송원": 10944,
    "한국체육산업개발(주)": None,
    "한국출판문화산업진흥원": 11073,
    "한국콘텐츠진흥원": 10950,
    "해외문화홍보원": 10945,
    "현충사관리소": None,
    "감사원": 10012,
    "고위공직자범죄수사처": None,
    "광주고등검찰청": None,
    "광주지방검찰청": None,
    "군사법원": 10350,
    "대검찰청": 10010,
    "대구고등검찰청": None,
    "대구지방검찰청": None,
    "대법원": 10014,
    "대전고등검찰청": None,
    "대전지방검찰청": None,
    "법무부": 10009,
    "법제처": 10013,
    "부산고등검찰청": None,
    "부산지방검찰청": None,
    "서울고등검찰청": None,
    "수원고등검찰청": None,
    "수원지방검찰청": None,
    "울산지방검찰청": None,
    "전주지방검찰청": None,
    "제주지방검찰청": None,
    "창원지방검찰청": None,
    "청주지방검찰청": None,
    "헌법재판소": 10015,
    "건강보험심사평가원": 10370,
    "국립암센터": None,
    "국립중앙의료원": 10986,
    "국민건강보험공단": 10087,
    "국민연금공단": 10957,
    "대구경북첨단의료산업진흥재단": None,
    "대한결핵협회": 10958,
    "대한적십자사": 10372,
    "보건복지부": 10086,
    "사회복지공동모금회": 11084,
    "식품안전정보원": 11273,
    "아동권리보장원": 11388,
    "오송첨단의료산업진흥재단": 11323,
    "의료기관평가인증원": 11396,
    "인구보건복지협회": 11274,
    "재단법인국가생명윤리정책원": None,
    "질병관리청": 10752,
    "한국건강증진개발원": 11294,
    "한국공공조직은행": 11345,
    "한국국제보건의료재단": 10987,
    "한국노인인력개발원": 11086,
    "한국마약퇴치운동본부": 11275,
    "한국보건복지인재원": None,
    "한국보건산업진흥원": 10895,
    "한국보건의료연구원": 11079,
    "한국보건의료인국가시험원": 11087,
    "한국보육진흥원": 11088,
    "한국사회보장정보원": 11322,
    "한국사회복지협의회": 11089,
    "한국식품안전관리인증원": 11295,
    "한국의료기기안전정보원": None,
    "한국의료분쟁조정중재원": 11296,
    "한국의약품안전관리원": 11297,
    "한국자활복지개발원": None,
    "한국장기조직기증원": 11347,
    "한국장애인개발원": 10989,
    "한국한의약진흥원": None,
    "한국희귀필수의약품센터": None,
    "공영홈쇼핑": 11403,
    "기술보증기금": 10748,
    "대한무역투자진흥공사": 10478,
    "대한석탄공사": 10897,
    "산업통상자원부": 11137,
    "소상공인시장진흥공단": 11299,
    "신용보증재단중앙회": 10993,
    "재단법인장애인기업종합지원센터": None,
    "전략물자관리원": 11067,
    "전력거래소": None,
    "주식회사강원랜드": 10483,
    "중소기업기술정보진흥원": 10994,
    "중소기업유통센터": 11160,
    "중소벤처기업부": 11359,
    "중소벤처기업연구원": None,
    "중소벤처기업진흥공단": None,
    "창업진흥원": 11161,
    "특허청": 10085,
    "한국가스공사": 10487,
    "한국가스기술공사": 10962,
    "한국가스안전공사": 10488,
    "한국광해광업공단": None,
    "한국남동발전": None,
    "한국남부발전(주)": 10490,
    "한국동서발전": None,
    "한국디자인진흥원": 11070,
    "한국로봇산업진흥원": 11074,
    "한국무역보험공사": 10995,
    "한국발명진흥회": 10492,
    "한국벤처투자": 11159,
    "한국산업기술시험원": 10996,
    "한국산업기술진흥원": 10965,
    "한국산업기술평가관리원": 11068,
    "한국산업단지공단": 10494,
    "한국서부발전": None,
    "한국석유공사": 10496,
    "한국석유관리원": 10997,
    "한국세라믹기술원": 10998,
    "한국수력원자력(주)": 10497,
    "한국에너지공단": 11366,
    "한국에너지기술평가원": 10967,
    "한국에너지재단": None,
    "한국에너지정보문화재단": None,
    "한국원자력환경공단": 11156,
    "한국전기안전공사": 10500,
    "한국전력공사": 10501,
    "한국전력국제원자력대학원대학교": 11368,
    "한국전력기술주식회사": None,
    "한국제품안전관리원": None,
    "한국중부발전(주)": 10503,
    "한국지식재산보호원": None,
    "한국지식재산연구원": 11165,
    "한국지역난방공사": 10504,
    "한국탄소산업진흥원": None,
    "한국특허전략개발원": 11369,
    "한국특허정보원": 10506,
    "한전KDN(주)": 10509,
    "한전KPS": None,
    "한전엠씨에스(주)": None,
    "한전원자력연료(주)": 10508,
    "여성가족부": 10231,
    "한국건강가정진흥원": 11215,
    "한국양성평등교육진흥원": 10390,
    "한국여성인권진흥원": 11216,
    "한국청소년상담복지개발원": 11077,
    "한국청소년활동진흥원": 11043,
    "남북교류협력지원협회": 11112,
    "북한이탈주민지원재단": 11113,
    "재외동포재단": 11114,
    "한국국제교류재단": 10474,
    "한국국제협력단": 10475,
    "한ㆍ아프리카재단": None,
    "88관광개발주식회사": 10028,
    "개인정보보호위원회": 11415,
    "경제ㆍ인문사회연구회": None,
    "공정거래위원회": 10022,
    "국가보훈처": 10026,
    "국무조정실국무총리비서실": 11158,
    "국민권익위원회": 10930,
    "금융감독원": 10024,
    "금융위원회": 10932,
    "독립기념관": 10527,
    "서민금융진흥원": 11375,
    "신용보증기금": 10046,
    "예금보험공사": 10049,
    "중소기업은행": 10044,
    "한국공정거래조정원": 10934,
    "한국보훈복지의료공단": 10528,
    "한국산업은행": 10042,
    "한국소비자원": 10935,
    "한국자산관리공사": 10025,
    "한국주택금융공사": 10512,
    "MG새마을금고중앙회": None,
    "경기남부경찰청": None,
    "경기북부경찰청": None,
    "경상남도": 10742,
    "경상남도경찰청": None,
    "경상북도": 10743,
    "경상북도경찰청": 10548,
    "경찰공제회": 11001,
    "경찰청": 10071,
    "공무원연금공단": 11002,
    "광주광역시": 10856,
    "광주광역시경찰청": 10858,
    "대전광역시": 10857,
    "대전광역시경찰청": 10859,
    "대한소방공제회": None,
    "대한지방행정공제회": None,
    "도로교통공단": 10862,
    "민주화운동기념사업회": 11157,
    "바르게살기운동중앙협의회": None,
    "새마을운동중앙회": 11240,
    "서울경찰청": None,
    "세종경찰청": None,
    "세종특별자치시": 11301,
    "소방산업공제조합": None,
    "소방청": 11354,
    "울산경찰청": None,
    "울산광역시": 10538,
    "인사혁신처": 11277,
    "일제강제동원피해자지원재단": 11358,
    "제주특별자치도": 10446,
    "제주특별자치도경찰청": 10544,
    "중앙선거관리위원회": 10072,
    "지방공기업평가원": 11090,
    "진실ㆍ화해를위한과거사정리위원회": None,
    "충청북도": 10373,
    "충청북도경찰청": None,
    "특수법인총포화약안전기술협회": None,
    "한국섬진흥원": None,
    "한국소방산업기술원": 11091,
    "한국소방시설협회": 11409,
    "한국소방안전원": 11410,
    "한국승강기안전공단": 11364,
    "한국자유총연맹": 11241,
    "한국지방세연구원": None,
    "한국지방재정공제회": 11045,
    "한국지방행정연구원": 10861,
    "한국지역정보개발원": None,
    "행정안전부": 10855,
    "재단법인차세대수치예보모델개발사업단": None,
    "APEC기후센터": None,
    "건설근로자공제회": 11159,
    "경제사회노동위원회": None,
    "고용노동부": 11008,
    "고용노동부고객상담센터": None,
    "고용보험심사위원회": 11092,
    "광주지방고용노동청": 11009,
    "국가기상위성센터": None,
    "국가미세먼지정보센터": None,
    "국립공원공단": 10429,
    "국립기상과학원": None,
    "국립낙동강생물자원관": 11332,
    "국립생물자원관": 11075,
    "국립생태원": 11242,
    "국립야생동물질병관리원": None,
    "국립호남권생물자원관": None,
    "국립환경과학원": 10430,
    "국립환경인재개발원": None,
    "근로복지공단": 10459,
    "금강유역환경청": 10432,
    "금강홍수통제소": None,
    "기상기후인재개발원": None,
    "기상레이더센터": None,
    "기상청": 10325,
    "낙동강유역환경청": 10433,
    "노사발전재단": 11093,
    "대구지방고용노동청": 11010,
    "대구지방기상청": None,
    "대구지방환경청": 10436,
    "대전지방고용노동청": 11011,
    "부산지방고용노동청": 11012,
    "산업재해보상보험재심사위원회": 11094,
    "서울지방고용노동청": 11013,
    "수도권기상청": None,
    "수도권대기환경청": 10441,
    "수도권매립지관리공사": 10442,
    "수자원환경산업진흥(주)": None,
    "수치모델링센터": None,
    "영산강유역환경청": 10443,
    "영산강홍수통제소": None,
    "온실가스종합정보센터": 11076,
    "원주지방환경청": 10444,
    "전북지방환경청": 11390,
    "중부지방고용노동청": 11014,
    "중앙노동위원회": 10447,
    "중앙환경분쟁조정위원회": 10448,
    "최저임금위원회": 11077,
    "학교법인한국폴리텍": 10976,
    "한강유역환경청": 10913,
    "한강홍수통제소": 11421,
    "한국고용노동교육원": None,
    "한국고용정보원": 10451,
    "한국기상산업기술원": None,
    "한국기술교육대학교": 10452,
    "한국사회적기업진흥원": 11078,
    "한국산업안전보건공단": 10977,
    "한국산업인력공단": 10458,
    "한국상하수도협회": 11327,
    "한국수자원공사": 10316,
    "한국수자원조사기술원": 11391,
    "한국잡월드": 11160,
    "한국장애인고용공단": 11105,
    "한국환경공단": 11120,
    "한국환경산업기술원": 10978,
    "항공기상청": None,
    "화학물질안전원": 11243,
    "환경보전협회": 11372,
    "환경부": 11139
}


def write_excel(wb, input_path, output_path, book_level):  # pylint: disable=R0914
    """정리된 북마크 리스트를 통해 엑셀로 변환합니다. """
    ws = wb.active

    for root, _, files in os.walk(input_path):
        for file in natsorted(files):
            if not file.lower().endswith('.pdf'):
                continue
            first_underscore_index = file.find('_')
            second_underscore_index = file.find(
                '_', first_underscore_index + 1)
            if first_underscore_index != -1 and second_underscore_index != -1:
                cmt = file[first_underscore_index + 1:second_underscore_index]
            else:
                cmt = ""

            org_matches = re.findall(r'\(([^)]+)\)', file)
            if org_matches:
                org = org_matches[-1]
                if org == '2':
                    org = org_matches[-2]
                if str(org).endswith('(주'):
                    org = str(org).replace('(주', '(주)')
            else:
                org = ""

            file_path = os.path.join(root, file)
            tmp = 1
            for item in extract_bookmark(file_path):
                if len(item) > 1 and item['level'] == book_level:
                    ws.cell(row=ws.max_row + tmp, column=2, value=org)
                    ws.cell(row=ws.max_row + tmp, column=3,
                            value=organization_dict[org] if org in organization_dict else None)
                    ws.cell(row=ws.max_row + tmp, column=4, value=cmt)
                    ws.cell(row=ws.max_row + tmp, columm=5,
                            value=committee_dict[cmt] if cmt in committee_dict else None)
                    ws.cell(row=ws.max_row + tmp, column=11, value=file)
                    if book_level > 1:
                        ws.cell(row=ws.max_row + tmp, column=6,
                                value=item['parent']['title'])
                    ws.cell(row=ws.max_row + tmp, column=9,
                            value=item['title'])
                    tmp += 1

    wb.save(output_path)


def has_header(wb, output_path):
    """엑셀 header가 존재하는지 확인합니다. 존재하지 않을 경우 새로 생성합니다"""
    ws = wb.active
    first_row = ws[1]
    header_exists = any(cell.value for cell in first_row)

    if not header_exists:
        headers = ['일련번호', '기관명', '기관코드', '위원회명', '위원회 코드',
                   '위원(의원)명', '위원(의원) 코드', '질의유형', '질의', '답변 책자 파일명', '파일명']
        for col_idx, header in enumerate(headers, start=1):
            ws.cell(row=1, column=col_idx, value=header)
        fill_color = PatternFill(start_color='4f81bd',
                                 end_color='4f81bd', fill_type='solid')
        for col in range(1, 12):
            ws.cell(row=1, column=col).fill = fill_color
    wb.save(output_path)
    return wb


def load_excel(output_path):
    """엑셀을 불러옵니다. 파일이 없는 경우 새로 생성됩니다"""
    if os.path.exists(output_path):
        wb = load_workbook(output_path)
    else:
        try:
            output_excel = output_path
            wb = Workbook()
            wb.save(output_excel)
            wb = load_workbook(output_excel)
        except Exception:  # pylint: disable=W0703
            e = "엑셀 파일 생성 오류"
            logging(e, '', output_path)

    return has_header(wb, output_path)
